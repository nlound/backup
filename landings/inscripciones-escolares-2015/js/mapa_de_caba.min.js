function ready(a,b,c){var d=[];$(document).mousemove(function(a){d[0]=a.clientX,d[1]=a.clientY});for(var e=0,f=Number.MAX_VALUE,g=1;16>g;g++)e<c.comunas[nivelActivo][g]&&(e=c.comunas[nivelActivo][g]),f>c.comunas[nivelActivo][g]&&(f=c.comunas[nivelActivo][g]);var h=d3.scale.linear().domain([f,e]).range(coloresCABA);svg.select(".caba").remove(),svg.select(".etiqueta").remove(),svg.append("g").attr("class","caba").selectAll("path").data(topojson.feature(b,b.objects.comunas).features).enter().append("path").attr("d",d3.geo.path().projection(d3.geo.mercator().scale(78500).center([-58.2,-34.68102]))).style("fill",function(a){return h(c.comunas[nivelActivo][a.properties.comuna])}).attr("title",function(a){return c.comunas[nivelActivo][a.properties.comuna]+" nuevos alumnos"}).on("mouseover",function(a){$("#tooltipCABA").show(),d3.select(this).style("stroke","#ffffff");var b="<div style='font-size: 10px; text-transform: uppercase; color: #999999;'> comuna "+a.properties.comuna+" </div> "+c.comunas[nivelActivo][a.properties.comuna]+" nuevos alumnos";$("#tooltipCABA").html(b)}).on("mouseout",function(){$("#tooltipCABA").hide(),d3.select(this).style("stroke","transparent")}).on("mousemove",function(){$("#tooltipCABA").show();d3.mouse(svg.node()).map(function(a){return parseInt(a)});d3.select("#tooltipCABA").attr("style",function(){return"left:"+(d[0]-60)+"px; top:"+(d[1]-70)+"px"})});var i=svg.append("svg:defs").append("svg:linearGradient").attr("id","gradient").attr("x1","0%").attr("x2","100%");i.append("svg:stop").attr("offset","20%").attr("stop-color",coloresCABA[0]).attr("stop-opacity",1),i.append("svg:stop").attr("offset","80%").attr("stop-color",coloresCABA[1]).attr("stop-opacity",1);var j=svg.append("g").attr("class","etiqueta").attr("transform","translate(170,267)");j.append("rect").attr("height",7).attr("x",0).attr("width","130").style("fill","url(#gradient)").style("stroke","white"),j.append("text").attr("class","tituloLeyenda").attr("y",-6).text("Alumnos por comuna"),j.append("text").attr("class","numeroLeyenda").attr("y",20).attr("x",0).text(function(){return redondeo(f,"DOWN")}),j.append("text").attr("class","numeroLeyenda").attr("y",20).attr("x",95).text(function(){return redondeo(e,"UP")})}function redondeo(a,b){switch(b){case"UP":var c="+ de "+(100*Math.round(a/100)-100).toString();break;case"DOWN":var c="- de "+(100*Math.round(a/100)).toString()}return c}$("#tooltipCABA").hide();var coloresCABA=["#eaeaea","#1977DD"],svg=d3.select("#mapaCABA").append("svg").attr("width",mapaSvg.ancho).attr("height",mapaSvg.alto).attr("x",mapaSvg.posInicialX).attr("y",mapaSvg.posInicialY);queue().defer(d3.json,"data/comunas.json").defer(d3.json,"data/data.json").await(ready);