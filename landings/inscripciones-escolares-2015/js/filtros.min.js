function calcularCategoria(a,b,c){for(var d,e=0,f=niveles[e].total,g=0;c>=f;)e++,f+=niveles[e].total;if(e>0){var h=e;for(g=0;h>0;)g+=niveles[h-1].total,h--}d=c-g,indexInvertido=niveles[e].total-d;for(var i=0,j=b[e][i];indexInvertido>j;)i++,j+=b[e][i];return a[i]}function filtrar(a){if("general"==currentSeccion){for(var b=json[currentSeccion][a],c=Object.keys(b),d=[],e=0;e<c.length;e++)d.push(b[c[e]]*totalCirculos/100);d3.selectAll("circle").attr("class",function(a,b){for(var e=0,f=d[e];b>f;)e++,f+=d[e];return currentSeccion+" "+c[e]})}else{for(var f=[],g=[],e=0;e<niveles.length;e++){for(var h=Object.keys(json.niveles),i=json.niveles[h[e]][a],j=Object.keys(i),k=[],l=0,m=0;m<j.length;m++)l=Math.round(i[j[m]]*niveles[e].total/100),k.push(l);f.push(k),g.push(j)}if(d3.selectAll("circle").attr("class",function(a,b){var c=d3.select(this).attr("nivel"),d=this.classList.contains("nivel_activo"),e=calcularCategoria(g[c],f,b),h=currentSeccion+" nivel"+c+" "+e;return d&&(h+=" nivel_activo"),h}),"comuna"==currentSeccion){var n=$("circle.nivel_activo").attr("nivel");d3.selectAll("g.info text[nivel='"+n+"']").attr("class",function(){return d3.select(this).attr("class")+" nivel_activo animated fadeInUp"})}}}$("input[name=filtro]").click(function(){var a=$(this).attr("previousValue"),b=$(this).attr("name");if("checked"==a)$(this).removeAttr("checked"),$(this).attr("previousValue",!1),resetRadio(this),d3.selectAll("circle").attr("fill",colores.neutro).attr("class",function(){var a=currentSeccion+" general";if("general"!=currentSeccion){var b=d3.select(this).attr("nivel");if(a+=" nivel"+b,"comuna"==currentSeccion){var c=this.classList.contains("nivel_activo");c&&(a+=" nivel_activo")}}return a}),$("g.info").hide();else{$("input[name="+b+"]:radio").attr("previousValue",!1),$(this).attr("previousValue","checked");var c=$(this).val();filtrar(c),generarInfoText(c),$(this).blur()}});