<<<<<<< HEAD
function wrap(a,b){a.each(function(){for(var a,c=d3.select(this),d=c.text().split(/\s+/).reverse(),e=[],f=0,g=1.1,h=c.attr("y"),i=c.attr("x"),j=parseFloat(c.attr("dy")),k=c.text(null).append("tspan").attr("x",i).attr("y",h).attr("dy",j+"em");a=d.pop();)e.push(a),k.text(e.join(" ")),k.node().getComputedTextLength()>b&&(e.pop(),k.text(e.join(" ")),e=[a],k=c.append("tspan").attr("y",h).attr("x",i).attr("dy",++f*g+j+"em").text(a))})}function addCommas(a){a+="",x=a.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var b=/(\d+)(\d{3})/;b.test(x1);)x1=x1.replace(b,"$1,$2");return x1+x2}var custom_bubble_chart,container,referencias;container=$("#contenedor-visualizacion"),referencias=$(".referencias"),d3.csv("data/presupuesto.csv",function(a){var b=[],c=[],d=[],e=[],f=[],g=[];a.forEach(function(a){b.indexOf(a.jurisdiccion)<0&&(b.push(a.jurisdiccion),g.push(0)),c.indexOf(a.id_jurisdiccion)<0&&c.push(a.id_jurisdiccion),d.indexOf(a.finalidad)<0&&(d.push(a.finalidad),f.push(0)),e.indexOf(a.id_finalidad)<0&&e.push(a.id_finalidad),f[d.indexOf(a.finalidad)]=parseInt(f[d.indexOf(a.finalidad)])+parseInt(a.monto),g[b.indexOf(a.jurisdiccion)]=parseInt(g[b.indexOf(a.jurisdiccion)])+parseInt(a.monto)});for(var h=[],i=0;i<d.length;i++)h[i]=[d[i],f[i],e[i]];h.sort(function(a,b){return d3.descending(a[1],b[1])});for(var j=[],i=0;i<b.length;i++)j[i]=[b[i],g[i],c[i]];j.sort(function(a,b){return d3.descending(a[1],b[1])}),custom_bubble_chart=function(a,c){"use strict";function e(a){var b=40;return 1===a?z/M*a+100:z/M*a+100+a*b}function f(b){var c=a.max(b,function(a){return parseInt(a.monto,10)}),d=a.scale.linear().domain([0,c]).range([F,G]);b.forEach(function(a){var b={id:a.id_jurisdiccion,radius:d(parseInt(a.monto,10)),monto:a.monto,jurisdiccion:a.jurisdiccion,id_jurisdiccion:a.id_jurisdiccion,finalidad:a.finalidad,id_finalidad:a.id_finalidad,funcion:a.funcion,id_funcion:a.id_funcion,x:Math.random()*y,y:Math.random()*z};E.push(b)}),E.sort(function(a,b){return b.monto-a.monto}),v=a.select("#presupuesto-visualizado").append("svg").attr("width",y),x=v.selectAll("circle").data(E).enter().append("circle").attr("r",0).style("opacity",.9).attr("fill",function(a){return Q(a.finalidad)}).attr("stroke-width",1.5).attr("stroke",function(b){return a.rgb(Q(b.finalidad)).darker()}).attr("id",function(a){return"bubble_"+a.id_finalidad}).on("mouseover",function(b,c){var d=a.select(this);d.style("stroke-width",3),d.style("opacity",.9),t(b,c,this)}).on("mouseout",function(b,c){u(b,c,this);var d=a.select(this);d.style("stroke-width",1.5),d.style("opacity",function(){return $("#jurisdiccion").hasClass("disabled")?.3:.9})}),x.transition().duration(1500).attr("r",function(a){return a.radius})}function g(a){return a.value<0?0:-Math.pow(a.radius,1.9)}function i(){w=a.layout.force().nodes(E).size([y,z])}function k(){w.gravity(B).charge(g).friction(C).on("tick",function(a){x.each(l(a.alpha)).attr("fill",function(a){return Q(a.finalidad)}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).style("opacity",.9)}),w.start(),s()}function l(a){return function(b){b.x=b.x+(I.x-b.x)*(D+.02)*a,b.y=b.y+(I.y-b.y)*(D+.02)*a}}function m(){w.gravity(-.01).charge(g).friction(.5).on("tick",function(a){x.each(n(a.alpha)).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("fill","#FFF")}),w.start(),r()}function n(a){return function(b){var c=O[b.id_jurisdiccion];b.x=b.x+(c.x-b.x)*(D+.02)*a*1.2,b.y=b.y+(c.y-b.y)*(D+.02)*a*1.2}}function o(){w.gravity(B).charge(g).friction(.9).on("tick",function(a){x.each(p(a.alpha)).attr("fill",function(a){return Q(a.finalidad)}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).style("opacity",.9)}),w.start(),q()}function p(a){return function(b){var c=J[b.id_finalidad];b.x=b.x+(c.x-b.x)*(D+.02)*a*1.2,b.y=b.y+(c.y-b.y)*(D+.02)*a*1.2}}function q(){s();var b=J,c=a.keys(b),d=v.append("g").classed("finalidad",!0).attr("transform","translate(0,"+(z-90)+")").selectAll(".finalidad").data(c);d.enter().append("text").style("opacity",0).attr("class","titulo").attr("x",function(a){return b[a].x}).attr("dy","3em").attr("y",-20).attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return b[a].id}).call(wrap,130).transition().duration(500).style("opacity",1),d.enter().append("text").style("opacity",0).attr("class","total").attr("x",function(a){return b[a].x}).attr("y",0).attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return"$"+H(b[a].monto)}).transition().duration(750).style("opacity",1)}function r(){s();var b=O,c=a.keys(O),d=v.append("g").classed("jurisdiccion",!0).attr("transform","translate(0,0)").selectAll(".jurisdiccion").data(c);d.enter().append("text").style("opacity",0).attr("class","titulo").attr("x",function(a){return b[a].x}).attr("dy","3em").attr("y",function(a){return b[a].y-20}).style("pointer-events","none").attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return b[a].id}).call(wrap,130).transition().duration(500).style("opacity",1),d.enter().append("text").style("opacity",0).attr("class","total").attr("x",function(a){return b[a].x}).attr("y",function(a){return b[a].y}).style("pointer-events","none").attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return"$"+H(b[a].monto)}).transition().duration(750).style("opacity",1)}function s(){v.selectAll(".finalidad").remove(),v.selectAll(".jurisdiccion").remove()}function t(b,c,d){a.select(d).attr("stroke","black");var e='<span class="name">Finalidad:</span><span class="value"> '+b.finalidad+"</span><br/>";e+='<span class="name">Función:</span><span class="value"> '+b.funcion+"</span><br/>",e+='<span class="name">Jurisdicción:</span><span class="value"> '+b.jurisdiccion+"</span><br/>",e+='<span class="name">Monto:</span><span class="value"> $'+addCommas(H(b.monto))+"</span>",A.showTooltip(e,a.event)}function u(b,c,d){a.select(d).attr("stroke",function(b){return a.rgb(Q(b.finalidad)).darker()}),A.hideTooltip()}for(var v,w,x,y=1200,z=600,A=c("tooltip",300),B=-.01,C=.9,D=.45,E=[],F=3,G=110,H=function(a){return formatNumber(1*a)},I={x:y/2,y:z/2},J={},K=0;K<d.length;K++)J[parseInt(h[K][2])]={id:h[K][0],monto:h[K][1],x:(K+1)*y/6,y:z/2};for(var L=4,M=6,N=250,O={},P=[1,1],K=0;K<b.length;K++)O[parseInt(j[K][2])]={id:j[K][0],monto:j[K][1],x:P[0]*(y-N)/L,y:e(P[1])},P[0]++,5===P[0]&&(P[0]=1,P[1]++);var Q=a.scale.ordinal().domain(d).range(["#ECD078","#D95B43","#C02942","#542437","#53777A"]);a.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};var R={};return R.init=function(a){f(a),i()},R.cambiarVista=function(a){"finalidad"==a?(o(),container.delay(200).animate({height:600},1e3),referencias.animate({opacity:0},250)):"jurisdiccion"==a?(m(),x.style("opacity",.3),container.animate({height:170*M},500),referencias.animate({opacity:0},250)):(k(),container.delay(200).animate({height:600},1e3),referencias.delay(300).animate({opacity:1},350))},R}(d3,CustomTooltip),custom_bubble_chart.init(a);var k=$(location).attr("href");"/total"==k.split("#")[1]?($("#seleccion a").removeClass("disabled"),$("#total").toggleClass("disabled"),custom_bubble_chart.cambiarVista("total")):"/finalidad"==k.split("#")[1]?($("#seleccion a").removeClass("disabled"),$("#finalidad").toggleClass("disabled"),custom_bubble_chart.cambiarVista("finalidad")):"/jurisdiccion"==k.split("#")[1]?($("#seleccion a").removeClass("disabled"),$("#jurisdiccion").toggleClass("disabled"),custom_bubble_chart.cambiarVista("jurisdiccion")):custom_bubble_chart.cambiarVista("total")});var formatNumber=function(a,b){var c,d,e,f,g,h,i;return i="",f="",g="",a>=1e9?(i=" mil millones",a/=1e9,b=1):a>=1e6?(i=" millones",a/=1e6,b=1):a>=1e5&&(i="",a/=1e5,b=1),h="",b>0?(1>a&&(h="0"),c=String(Math.round(a*Math.pow(10,b))),10>c?(d="0"+c.substr(c.length-b,b),e=""):(d=c.substr(c.length-b,b),e=c.substr(0,c.length-b)),f+h+e.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+"."+d+i+g):(c=String(Math.round(a)),c=c.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),f+c+i+g)};$(document).ready(function(){$("#seleccion a").click(function(){var a=$(this).attr("id");return window.location="#/"+a,$("#seleccion a").removeClass("disabled"),$(this).toggleClass("disabled"),custom_bubble_chart.cambiarVista(a),!1})});
=======
function wrap(a,b){a.each(function(){for(var a,c=d3.select(this),d=c.text().split(/\s+/).reverse(),e=[],f=0,g=1.1,h=c.attr("y"),i=c.attr("x"),j=parseFloat(c.attr("dy")),k=c.text(null).append("tspan").attr("x",i).attr("y",h).attr("dy",j+"em");a=d.pop();)e.push(a),k.text(e.join(" ")),k.node().getComputedTextLength()>b&&(e.pop(),k.text(e.join(" ")),e=[a],k=c.append("tspan").attr("y",h).attr("x",i).attr("dy",++f*g+j+"em").text(a))})}function addCommas(a){a+="",x=a.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var b=/(\d+)(\d{3})/;b.test(x1);)x1=x1.replace(b,"$1,$2");return x1+x2}var custom_bubble_chart,container,referencias;container=$("#contenedor-visualizacion"),referencias=$(".referencias"),d3.csv("data/presupuesto.csv",function(a){var b=[],c=[],d=[],e=[],f=[],g=[];a.forEach(function(a){b.indexOf(a.jurisdiccion)<0&&(b.push(a.jurisdiccion),g.push(0)),c.indexOf(a.id_jurisdiccion)<0&&c.push(a.id_jurisdiccion),d.indexOf(a.finalidad)<0&&(d.push(a.finalidad),f.push(0)),e.indexOf(a.id_finalidad)<0&&e.push(a.id_finalidad),f[d.indexOf(a.finalidad)]=parseInt(f[d.indexOf(a.finalidad)])+parseInt(a.monto),g[b.indexOf(a.jurisdiccion)]=parseInt(g[b.indexOf(a.jurisdiccion)])+parseInt(a.monto)});for(var h=[],i=0;i<d.length;i++)h[i]=[d[i],f[i],e[i]];h.sort(function(a,b){return d3.descending(a[1],b[1])});for(var j=[],i=0;i<b.length;i++)j[i]=[b[i],g[i],c[i]];j.sort(function(a,b){return d3.descending(a[1],b[1])}),custom_bubble_chart=function(a,c){"use strict";function e(a){var b=40;return 1===a?z/M*a+100:z/M*a+100+a*b}function f(b){var c=a.max(b,function(a){return parseInt(a.monto,10)}),d=a.scale.linear().domain([0,c]).range([F,G]);b.forEach(function(a){var b={id:a.id_jurisdiccion,radius:d(parseInt(a.monto,10)),monto:a.monto,jurisdiccion:a.jurisdiccion,id_jurisdiccion:a.id_jurisdiccion,finalidad:a.finalidad,id_finalidad:a.id_finalidad,funcion:a.funcion,id_funcion:a.id_funcion,x:Math.random()*y,y:Math.random()*z};E.push(b)}),E.sort(function(a,b){return b.monto-a.monto}),v=a.select("#presupuesto-visualizado").append("svg").attr("width",y),x=v.selectAll("circle").data(E).enter().append("circle").attr("r",0).style("opacity",.9).attr("fill",function(a){return Q(a.finalidad)}).attr("stroke-width",1.5).attr("stroke",function(b){return a.rgb(Q(b.finalidad)).darker()}).attr("id",function(a){return"bubble_"+a.id_finalidad}).on("mouseover",function(b,c){var d=a.select(this);d.style("stroke-width",3),d.style("opacity",.9),t(b,c,this)}).on("mouseout",function(b,c){u(b,c,this);var d=a.select(this);d.style("stroke-width",1.5),d.style("opacity",function(){return $("#jurisdiccion").hasClass("disabled")?.3:.9})}),x.transition().duration(1500).attr("r",function(a){return a.radius})}function g(a){return a.value<0?0:-Math.pow(a.radius,1.9)}function i(){w=a.layout.force().nodes(E).size([y,z])}function k(){w.gravity(B).charge(g).friction(C).on("tick",function(a){x.each(l(a.alpha)).attr("fill",function(a){return Q(a.finalidad)}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).style("opacity",.9)}),w.start(),s()}function l(a){return function(b){b.x=b.x+(I.x-b.x)*(D+.02)*a,b.y=b.y+(I.y-b.y)*(D+.02)*a}}function m(){w.gravity(-.01).charge(g).friction(.5).on("tick",function(a){x.each(n(a.alpha)).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("fill","#FFF")}),w.start(),r()}function n(a){return function(b){var c=O[b.id_jurisdiccion];b.x=b.x+(c.x-b.x)*(D+.02)*a*1.2,b.y=b.y+(c.y-b.y)*(D+.02)*a*1.2}}function o(){w.gravity(B).charge(g).friction(.9).on("tick",function(a){x.each(p(a.alpha)).attr("fill",function(a){return Q(a.finalidad)}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).style("opacity",.9)}),w.start(),q()}function p(a){return function(b){var c=J[b.id_finalidad];b.x=b.x+(c.x-b.x)*(D+.02)*a*1.2,b.y=b.y+(c.y-b.y)*(D+.02)*a*1.2}}function q(){s();var b=J,c=a.keys(b),d=v.append("g").classed("finalidad",!0).attr("transform","translate(0,"+(z-90)+")").selectAll(".finalidad").data(c);d.enter().append("text").style("opacity",0).attr("class","titulo").attr("x",function(a){return b[a].x}).attr("dy","3em").attr("y",-20).attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return b[a].id}).call(wrap,130).transition().duration(500).style("opacity",1),d.enter().append("text").style("opacity",0).attr("class","total").attr("x",function(a){return b[a].x}).attr("y",0).attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return"$"+H(b[a].monto)}).transition().duration(750).style("opacity",1)}function r(){s();var b=O,c=a.keys(O),d=v.append("g").classed("jurisdiccion",!0).attr("transform","translate(0,0)").selectAll(".jurisdiccion").data(c);d.enter().append("text").style("opacity",0).attr("class","titulo").attr("x",function(a){return b[a].x}).attr("dy","3em").attr("y",function(a){return b[a].y-20}).style("pointer-events","none").attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return b[a].id}).call(wrap,130).transition().duration(500).style("opacity",1),d.enter().append("text").style("opacity",0).attr("class","total").attr("x",function(a){return b[a].x}).attr("y",function(a){return b[a].y}).style("pointer-events","none").attr("text-wrap","normal").attr("text-anchor","middle").text(function(a){return"$"+H(b[a].monto)}).transition().duration(750).style("opacity",1)}function s(){v.selectAll(".finalidad").remove(),v.selectAll(".jurisdiccion").remove()}function t(b,c,d){a.select(d).attr("stroke","black");var e='<span class="name">Finalidad:</span><span class="value"> '+b.finalidad+"</span><br/>";e+='<span class="name">Función:</span><span class="value"> '+b.funcion+"</span><br/>",e+='<span class="name">Jurisdicción:</span><span class="value"> '+b.jurisdiccion+"</span><br/>",e+='<span class="name">Monto:</span><span class="value"> $'+addCommas(H(b.monto))+"</span>",A.showTooltip(e,a.event)}function u(b,c,d){a.select(d).attr("stroke",function(b){return a.rgb(Q(b.finalidad)).darker()}),A.hideTooltip()}for(var v,w,x,y=1200,z=600,A=c("tooltip",300),B=-.01,C=.9,D=.45,E=[],F=3,G=110,H=function(a){return formatNumber(1*a)},I={x:y/2,y:z/2},J={},K=0;K<d.length;K++)J[parseInt(h[K][2])]={id:h[K][0],monto:h[K][1],x:(K+1)*y/6,y:z/2};for(var L=4,M=6,N=250,O={},P=[1,1],K=0;K<b.length;K++)O[parseInt(j[K][2])]={id:j[K][0],monto:j[K][1],x:P[0]*(y-N)/L,y:e(P[1])},P[0]++,5===P[0]&&(P[0]=1,P[1]++);var Q=a.scale.ordinal().domain(d).range(["#ECD078","#D95B43","#C02942","#542437","#53777A"]);a.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};var R={};return R.init=function(a){f(a),i()},R.cambiarVista=function(a){"finalidad"==a?(o(),container.delay(200).animate({height:600},1e3),referencias.animate({opacity:0},250)):"jurisdiccion"==a?(m(),x.style("opacity",.3),container.animate({height:170*M},500),referencias.animate({opacity:0},250)):(k(),container.delay(200).animate({height:600},1e3),referencias.delay(300).animate({opacity:1},350))},R}(d3,CustomTooltip),custom_bubble_chart.init(a);var k=$(location).attr("href");"/total"==k.split("#")[1]?($("#seleccion a").removeClass("disabled"),$("#total").toggleClass("disabled"),custom_bubble_chart.cambiarVista("total")):"/finalidad"==k.split("#")[1]?($("#seleccion a").removeClass("disabled"),$("#finalidad").toggleClass("disabled"),custom_bubble_chart.cambiarVista("finalidad")):"/jurisdiccion"==k.split("#")[1]?($("#seleccion a").removeClass("disabled"),$("#jurisdiccion").toggleClass("disabled"),custom_bubble_chart.cambiarVista("jurisdiccion")):custom_bubble_chart.cambiarVista("total")});var formatNumber=function(a,b){var c,d,e,f,g,h,i;return i="",f="",g="",a>=1e9?(i=" mil millones",a/=1e9,b=1):a>=1e6?(i=" millones",a/=1e6,b=1):a>=1e5&&(i="",a/=1e5,b=1),h="",b>0?(1>a&&(h="0"),c=String(Math.round(a*Math.pow(10,b))),10>c?(d="0"+c.substr(c.length-b,b),e=""):(d=c.substr(c.length-b,b),e=c.substr(0,c.length-b)),f+h+e.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+"."+d+i+g):(c=String(Math.round(a)),c=c.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),f+c+i+g)};$(document).ready(function(){$("#seleccion a").click(function(){var a=$(this).attr("id");return window.location="#/"+a,$("#seleccion a").removeClass("disabled"),$(this).toggleClass("disabled"),custom_bubble_chart.cambiarVista(a),!1})});
>>>>>>> master
